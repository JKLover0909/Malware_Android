import os
import csv
import pandas as pd
import networkx as nx

folder_path = r'C:\Users\Admin\OneDrive - ptit.edu.vn\Desktop\File\School\ATBM\4K-Each-FCG'
csv_file_path = 'Allcorpus.csv'

def make_corpus(fcg_directory, csv_file_path):
    with open(csv_file_path, 'w', newline='', encoding='utf-8') as csvfile:
        writer = csv.writer(csvfile)
        for file in os.listdir(fcg_directory):
            if file.endswith('.gexf'):
                fcg = nx.read_gexf(os.path.join(fcg_directory, file))
                sequence = []
                for node in fcg.nodes():
                    lines = node.split('\n')
                    first_line = lines[0]  
                    if first_line.strip():  
                        sequence.append(first_line)
                    else:
                        if len(lines) > 1:
                            ans = lines[1]
                            ans = ans.replace('public', '')
                            ans = ans.replace('private', '')
                            ans = ans.replace('protected', '')
                            ans = ans.replace('static', '')
                            ans = ans.replace('final', '')
                            ans = ans.replace('void', '')
                            sequence.append(ans)
                writer.writerow(sequence)
                
make_corpus(folder_path, csv_file_path)

# Đọc dữ liệu từ tệp CSV vào một DataFrame
df = pd.read_csv(r'C:\Users\Admin\OneDrive - ptit.edu.vn\Desktop\File\School\ATBM\Allcorpus.csv')

# Loại bỏ các hàng trùng lặp
df.drop_duplicates(inplace=True)

# Ghi dữ liệu đã được xử lý vào tệp mới
df.to_csv('AllCorpus.csv', index=False)
